<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MATH3823 Generalised Linear Models - 7&nbsp; Extensions to Loglinear models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./6_loglinearmodel.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="webex.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./7_extendedloglinearmodel.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Extensions to Loglinear models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MATH3823 Generalised Linear Models</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weekly schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0_preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_linearmodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Essentials of Normal Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_GLM-Theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">GLM Theory</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_GLM-Fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">GLM Estimation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_logisticmodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modelling Proportions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_loglinearmodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loglinear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7_extendedloglinearmodel.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Extensions to Loglinear models</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">7.1</span> Overview</a></li>
  <li><a href="#contingency-tables-with-fixed-marginals" id="toc-contingency-tables-with-fixed-marginals" class="nav-link" data-scroll-target="#contingency-tables-with-fixed-marginals"><span class="header-section-number">7.2</span> Contingency tables with fixed marginals</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">7.2.1</span> Introduction</a></li>
  <li><a href="#modelling" id="toc-modelling" class="nav-link" data-scroll-target="#modelling"><span class="header-section-number">7.2.2</span> Modelling</a></li>
  </ul></li>
  <li><a href="#product-multinomial-models" id="toc-product-multinomial-models" class="nav-link" data-scroll-target="#product-multinomial-models"><span class="header-section-number">7.3</span> Product-multinomial models</a></li>
  <li><a href="#model-fitting-in-r" id="toc-model-fitting-in-r" class="nav-link" data-scroll-target="#model-fitting-in-r"><span class="header-section-number">7.4</span> Model fitting in <strong>R</strong></a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.5</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Extensions to Loglinear models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">7.1</span> Overview</h2>
<p>In this chapter we consider two extensions to the log-linear models studied in the previous chapter. Recall that the log-linear model assumes that each observation follows a Poisson distribution, but in many cases these will not be all independent. Instead, row totals or the grand total will be fixed. This structure means that the observed counts will no longer follow the Poisson distribution and hence modification to the theory and calculations are needed.</p>
</section>
<section id="contingency-tables-with-fixed-marginals" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="contingency-tables-with-fixed-marginals"><span class="header-section-number">7.2</span> Contingency tables with fixed marginals</h2>
<section id="introduction" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">7.2.1</span> Introduction</h3>
<p>In the melanoma example, see <a href="6_loglinearmodel.html#tbl-melanomacount1">Table&nbsp;<span>6.2</span></a>, the overall total number of observations was exactly <span class="math inline">\(400\)</span>. If the data were truly Poisson, this would be a suspiciously round number. In reality, this total was fixed by design, so we should take into account the fact that <span class="math inline">\(y_{++} = 400\)</span> and fit a more appropriate model. Also, recall the flu vaccine example of <a href="6_loglinearmodel.html#tbl-flucount">Table&nbsp;<span>6.5</span></a>. Suppose that some of the marginal totals are fixed by design. For example, that the number of patients in each arm of the trial (38 in the Placebo group, 35 in the Vaccine group) was fixed before data collection started. In this case, we should also take into account the fact that <span class="math inline">\(y_{1+}=38\)</span> and <span class="math inline">\(y_{2+}=35\)</span> and fit a more suitable model.</p>
<p>Before we can re-consider these data sets, we first need to establish some theoretical results to deal with such <em>conditional distribution</em> cases.</p>
</section>
<section id="modelling" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="modelling"><span class="header-section-number">7.2.2</span> Modelling</h3>
<p>Consider, again, a general two-way contingency table such as that in <a href="#tbl-twoway2">Table&nbsp;<span>7.1</span></a>. The fixed marginals are the column sums: <span class="math inline">\(y_{+j},\)</span> the row sums: <span class="math inline">\(y_{i+},\)</span> and the overall sum: <span class="math inline">\(y_{++}.\)</span></p>
<div id="tbl-twoway2" class="anchored">
<table class="table">
<caption>Table&nbsp;7.1: A two-way contingency table with <span class="math inline">\(k_1\)</span> rows and <span class="math inline">\(k_2\)</span> columns, where each entry <span class="math inline">\(y_{ij}\)</span> is a count.</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;"><span class="math inline">\(\dots\)</span></th>
<th style="text-align: center;"><span class="math inline">\(j\)</span></th>
<th style="text-align: center;"><span class="math inline">\(\dots\)</span></th>
<th style="text-align: center;"><span class="math inline">\(k_2\)</span></th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;"><span class="math inline">\(y_{11}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{12}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{1k_2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{1+}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(i\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{i1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{12}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{ik_2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{i+}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(k_1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{k_11}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{k_12}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{k_1j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{k_1k_2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{k_1+}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Total</strong></td>
<td style="text-align: center;"><span class="math inline">\(y_{+1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{+2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{+j}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\dots\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{+k_2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(y_{++}\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>Suppose that we have fixed row totals <span class="math inline">\(y_{i+},\)</span> or a fixed overall total <span class="math inline">\(y_{++}\)</span>, how would such constraints affect the distribution of the random variables <span class="math inline">\(Y_{ij}\)</span>?<br>
To answer this question, we will need the following results.</p>
<div id="prp-poissonsums1" class="proposition theorem proposition">
<p><span class="theorem-title"><strong>Proposition 7.1 </strong></span>Let <span class="math inline">\(Y_{ij}\)</span>, for <span class="math inline">\(i=1,\dots,k_1\)</span> and <span class="math inline">\(j=1,\dots, k_2\)</span>, be the responses in a two-way contingency table, with <span class="math inline">\(k_1\)</span> rows and <span class="math inline">\(k_2\)</span> columns. Further, assume that the counts follow independent Poisson distributions with corresponding means <span class="math inline">\(\lambda_{ij}\)</span>, that is <span class="math inline">\(Y_{ij}\sim \mbox{Po}(\lambda_{ij})\)</span>. Then, the distributions of the row sums are, <span class="math display">\[
Y_{i+} \sim \mbox{Po}(\lambda_{i+}),
\]</span> where <span class="math inline">\(\displaystyle Y_{i+} = \sum_{j=1}^{k_2} Y_{ij}\)</span> and <span class="math inline">\(\displaystyle \lambda_{i+}=\sum_{j=1}^{k_2} \lambda_{ij}\)</span>.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>Here we are not yet assuming that the marginal totals are fixed.</li>
<li>Similar results hold when considering column sums and the overall sum.</li>
</ul>
</div>
<p><strong>Proof:</strong> See MATH2715, Chapter 7 on <em>MGF Properties of Linear Functions</em>.</p>
<div id="prp-poissonsums2" class="proposition theorem proposition">
<p><span class="theorem-title"><strong>Proposition 7.2 </strong></span>Let <span class="math inline">\(Y_{ij}\sim \mbox{Po}(\lambda_{ij})\)</span> for <span class="math inline">\(i=1,\dots,k_1\)</span> and <span class="math inline">\(j=1,\dots, k_2\)</span> then the conditional distribution of each count in a row given that the row sum is fixed is given by <span class="math display">\[
\left( Y_{ij} \, |\,   Y_{i+} = m \right)
\sim
\mbox{Bin}\left(m,
\frac{\lambda_{ij}}{\lambda_{i+}}
\right).
\]</span> That is, conditioning on the sum of independent Poisson random variables induces a Binomial distribution.</p>
</div>
<p><strong>Proof:</strong> First define <span class="math inline">\(Y_{i-j}= Y_{i+}-Y_{ij}\)</span> with correspondingly <span class="math inline">\(y_{i-j}= m-y_{ij}\)</span> and also <span class="math inline">\(\lambda_{i-j}= \lambda_{i+}-\lambda_{ij}\)</span>.</p>
<p>Consider the conditional probability mass function <span class="math display">\[\begin{align*}
p(Y_{ij} = y_{ij} | Y_{i+} = m)  
&amp; = \frac{p(Y_{ij} = y_{ij}, Y_{i+} = m)} {p(Y_{i+} = m)}
\quad \text{by conditional probability definition}\\
&amp; = \frac{p(Y_{ij} = y_{ij}, Y_{i-j} = m-y_{ij})} {p(Y_{i+} = m)} \quad \text{rearranging} \\
&amp; = \frac{p(Y_{ij} = y_{ij})p(Y_{i-j} = m-y_{ij})} {p(Y_{i+} = m)} \quad \text{by independence}.
\end{align*}\]</span> Then, each of these follows a Poisson distribution: <span class="math inline">\(Y_{ij} \sim \text{Po}(\lambda_{ij})\)</span>, <span class="math inline">\(Y_{i-j}\sim \text{Po}(\lambda_{i-j})\)</span>, and <span class="math inline">\(Y_{i+} \sim \text{Po}(\lambda_{i+})\)</span>. Therefore, <span class="math display">\[\begin{align*}
p(Y_{ij} = y_{ij} | Y_{i+} = m)  
&amp; =
\frac{\lambda_{ij}^{y_{ij}}e^{-\lambda_{ij}}}{y_{ij}!}
\frac{\lambda_{i-j}^{m-y_{ij}}e^{-\lambda_{i-j}}}{m-y_{ij}!}
\Bigg/
\frac{\lambda_{i+}^{m} e^{-\lambda_{i+}}}{m!} \\
&amp; =
{m \choose y_{ij}}
\left(\frac{\lambda_{ij}}{\lambda_{i+}} \right) ^{y_{ij}}
\left(\frac{\lambda_{i-j}}{\lambda_{i+}} \right) ^{m-y_{ij}}\\
&amp; =
{m \choose y_{ij}}
\pi ^{y_{ij}}
\left(1-\pi\right) ^{m-y_{ij}}
\end{align*}\]</span></p>
<p>which is the probability mass function of a <span class="math inline">\(\text{Bin}(m, \pi)\)</span> random variable, where <span class="math inline">\(\pi = \lambda_{ij} / \lambda_{i+}\)</span>.</p>
<div id="prp-poissonsums3" class="proposition theorem proposition">
<p><span class="theorem-title"><strong>Proposition 7.3 </strong></span>Let <span class="math inline">\(Y_{ij}\sim \mbox{Po}(\lambda_{ij})\)</span> for <span class="math inline">\(i=1,\dots,k_1\)</span> and <span class="math inline">\(j=1,\dots, k_2\)</span> then the <strong>joint</strong> conditional distribution of the counts in a row given that the row sum is fixed is given by <span class="math display">\[
p(Y_{i1},\dots, Y_{i k_2} \, | \, Y_{i+}=m)
=
\frac{m!}{y_{i1}!\cdots y_{i k_2}!}
\pi_{i1}^{y_{i1}} \cdots\pi_{ik_2}^{y_{ik_2}}
\]</span> with <span class="math display">\[
\pi_{ij}=\lambda_{ij}/\lambda_{i+}
\quad \mbox{ and } \quad
\sum_{j=1}^{k_2} \pi_{ij} =1.
\]</span> This distribution is called the <em>Multinomial</em> distribution, with index <span class="math inline">\(m\)</span> and parameters <span class="math inline">\(\pi_{ij}, j=1,\dots k_2\)</span>, which can be denoted <span class="math display">\[
(Y_{i1},\dots, Y_{i k_2} \, | \, Y_{i+}=m)
\sim
\text{Mult}(m, \pi_{i1}, \dots \pi_{ik_2}
).
\]</span></p>
</div>
<p><strong>Proof:</strong> Omitted.</p>
<div id="prp-poissonsums4" class="proposition theorem proposition">
<p><span class="theorem-title"><strong>Proposition 7.4 </strong></span>Let <span class="math inline">\(Y_{ij}\sim \mbox{Po}(\lambda_{ij})\)</span> for <span class="math inline">\(i=1,\dots,k_1\)</span> and <span class="math inline">\(j=1,\dots, k_2\)</span> then the conditional distribution of the counts given that the overall sum is fixed is <span class="math display">\[
(Y_{11},\dots, Y_{k_1k_2} \, | \, Y_{++}=m)
\sim
\text{Mult}(m, \pi_{11},\dots, \pi_{k_1k_2}).
\]</span> with probability mass function given by <span class="math display">\[
p(Y_{11},\dots, Y_{k_1k_2} \, | \, Y_{++}=m)
=
\frac{m!}{y_{11}!\cdots y_{k_1k_2}!}
\pi_{11}^{y_{11}} \cdots\pi_{k_1k_2}^{y_{k_1k_2}}
\]</span> where <span class="math inline">\(\pi_{ij} = \lambda_{ij}/\lambda_{++}\)</span>.</p>
</div>
<p><strong>Proof:</strong> Omitted.</p>
</section>
</section>
<section id="product-multinomial-models" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="product-multinomial-models"><span class="header-section-number">7.3</span> Product-multinomial models</h2>
<p>The Poisson contingency table model assumes that each cell count (and therefore row and column total) is random – specifically, Poisson.<br>
However, in many examples, some of the marginal totals are fixed by design.</p>
<p>For example, as discussed in the Flu-vaccine example of <a href="6_loglinearmodel.html#sec-flucount"><span>Section&nbsp;6.2.2</span></a>, the numbers in the placebo (38) and vaccine (35) groups are not random, but fixed by the experimenter. Further, we are not interested in modelling these row totals but instead the response to treatment (placebo or vaccine). Thus, in the Flu vaccine example, we should condition the Poisson model on the row totals.</p>
<p>From <a href="6_loglinearmodel.html#eq-2waymodel">Equation&nbsp;<span>6.1</span></a> the saturated model for a two-factor table is <span class="math display">\[
\lambda_{ij} =
\exp\left\{\mu + \alpha_i + \beta_j + (\alpha \beta)_{ij}\right\}.
\]</span> Then, using the result in <a href="#prp-poissonsums3">Proposition&nbsp;<span>7.3</span></a>, we see that <span class="math display">\[
\pi_{ij} = \frac{\lambda_{ij}}{\lambda_{i+}}
=
\frac{\exp\left\{\mu + \alpha_i + \beta_j + (\alpha \beta)_{ij}\right\}}{\sum_j \exp\{\mu + \alpha_i + \beta_j + (\alpha \beta)_{ij}\}}
\]</span> which simplifies to give <span id="eq-pmulti"><span class="math display">\[
\pi_{ij}
=
\frac{\exp\left\{\beta_j + (\alpha \beta)_{ij}\right\}}{\sum_j \exp\left\{\beta_j + (\alpha \beta)_{ij}\right\} }.
\tag{7.1}\]</span></span> Thus, for each row, that is each <span class="math inline">\(i\)</span>, this multinomial distribution depends on <span class="math inline">\(\beta_j\)</span> and <span class="math inline">\((\alpha\beta)_{ij}\)</span> for <span class="math inline">\(j=1,\dots, k_2\)</span>, but not on <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\alpha_i\)</span>. This means that the data in each row of the table are independent and hence, overall, the model likelihood is given by <span class="math display">\[
L(\boldsymbol{\beta}; \mathbf{y}) =
\prod_{i=1}^{k_1}
p(Y_{i1},\dots, Y_{i k_2} \, | \, Y_{i+}=y_{i+}),
\]</span> with <span class="math inline">\(\boldsymbol{\beta}=\{\mu, \alpha_1,\dots, \alpha_{k_1}, \beta_1,\dots, \beta_{k_2}, (\alpha\beta)_{11},\dots, (\alpha\beta)_{k_1k_2}\}\)</span> and where <span class="math display">\[
p(Y_{i1},\dots, Y_{i k_2} \, | \, Y_{i+}=y_{i+})
=
\frac{y_{i+}!}{y_{i1}!\cdots y_{i k_2}!}
\pi_{i1}^{y_{i1}} \cdots\pi_{ik_2}^{y_{ik_2}} .
\]</span> Further, using <a href="#eq-pmulti">Equation&nbsp;<span>7.1</span></a> the log-likelihood is given by <span class="math display">\[
l(\boldsymbol{\beta}; \mathbf{y}) =
\text{const} +
\sum_{i=1}^{k_1} \sum_{j=1}^{k_2}
y_{ij}
\left\{
\beta_j + (\alpha \beta)_{ij}
-  \log \sum_j \exp\left\{\beta_j + (\alpha \beta)_{ij}\right\}\right\}.
\]</span> Recall that the saturated model will have the fitted values equal to the data values in all cases. Therefore, we concentrate on the product multinomial models with interactions set to zero, that is <span class="math inline">\((\alpha\beta)_{ij}=0\)</span>, then <span class="math display">\[
l(\boldsymbol{\beta}; \mathbf{y}) =
\text{const} +
\sum_{i=1}^{k_1} \sum_{j=1}^{k_2}
y_{ij} \left\{ \beta_j
-  \log \sum_j \exp\left\{\beta_j \right\}\right\}
\]</span> which simplifies to <span class="math display">\[
l(\boldsymbol{\beta}; \mathbf{y}) =
\text{const} +
\sum_{j=1}^{k_2}
y_{+j} \beta_j
-  y_{++}\log \sum_j \exp\left\{\beta_j \right\}.
\]</span> Differentiating this with respect to single parameter <span class="math inline">\(\beta_k\)</span> and setting to zero gives <span id="eq-fixedrows"><span class="math display">\[
\frac{y_{+k}}{y_{++}} =
{ e^{\hat\beta_k}}\Big/ {\sum_j e^{\hat\beta_j}}
\tag{7.2}\]</span></span> which is identical to the parameter estimate for the previous independence Poisson model. Thus, in this case, if we want to fit the product multinomial model (which is hard) we can instead fit the Poisson model (which is easy). Note, however, that these estimates only coincide when <span class="math inline">\(\alpha_1, \dots, \alpha_{k_1}\)</span> are included in the Poisson independence model, even though we see that these are eliminated from the multinomial model. In fact, these parameter estimates reflect the fixed marginal totals in the multinomial situation.</p>
<p>Although this derivation has only considered the cases of the independence Poisson model: <span class="math inline">\(\log \lambda_{ij} = \mu+\alpha_i+\beta_j\)</span> and the product multinomial model with <span class="math inline">\((\alpha\beta)_{ij}=0\)</span>, the following result gives general guidance.</p>
<div id="thm-multinomial" class="theorem theorem">
<p><span class="theorem-title"><strong>Theorem 7.1 </strong></span>Tables with fixed margin sums can be analyzed using a multinomial or product-multinomial model as though they were independent Poisson models, with log-linear predictor, provided terms corresponding to the fixed margins are included in the model. Then the MLEs for the two models yield the same values for the parameters of interest and have the same deviances.</p>
</div>
<p>For a 2-way table:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Multinomial conditioning on</th>
<th style="text-align: center;">Poisson model must include</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(y_{++}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(y_{i+}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu, \alpha_i\)</span></td>
</tr>
</tbody>
</table>
<p>For a 3-way table:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Multinomial conditioning on</th>
<th style="text-align: center;">Poisson model must include</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(y_{+++}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(y_{i++}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu, \alpha_i\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(y_{ij+}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu, \alpha_i, \beta_j, (\alpha\beta)_{ij}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(y_{ij+}\)</span>, <span class="math inline">\(y_{+jk}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu, \alpha_i, \beta_j, \gamma_k, (\alpha\beta)_{ij},(\beta\gamma)_{jk}\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Proof:</strong> Omitted. For details see Birch, 1963, JRSS(B), 220–233. The proof is not especially difficult but is a bit messy. It depends on the property of the Poisson model with log link function that observed totals equals fitted totals for the effects present in the Poisson model.</p>
</section>
<section id="model-fitting-in-r" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="model-fitting-in-r"><span class="header-section-number">7.4</span> Model fitting in <strong>R</strong></h2>
<p>Consider again he flu vaccine data described in <a href="6_loglinearmodel.html#sec-flucount"><span>Section&nbsp;6.2.2</span></a> with data repeated below. Recall that 38 people were recruited to the Placebo group and 35 to the Vaccine group and that we assume these were fixed before data collection started.</p>
<table class="table">
<caption>Antibody responses to flu vaccine from a randomised controlled trial.</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Group</th>
<th style="text-align: center;">Low</th>
<th style="text-align: center;">Moderate</th>
<th style="text-align: center;">High</th>
<th style="text-align: center;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Placebo</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;"><strong>38</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">Vaccine</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;"><strong>35</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Total</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">26</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">73</td>
</tr>
</tbody>
</table>
<p>The fixed row sums mean that a product-multinomial model is appropriate but this can be fitted using the usual same command as the Independence Poisson model as long as we include the term for the row effect, that is for Group.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>count    <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">18</span>, <span class="dv">11</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>antibody <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>,  <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>group    <span class="ot">=</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>,  <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>antibodyF <span class="ot">=</span> <span class="fu">as.factor</span>(antibody)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>groupF <span class="ot">=</span> <span class="fu">as.factor</span>(group)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>glm.fit <span class="ot">=</span> <span class="fu">glm</span>(count <span class="sc">~</span> antibodyF <span class="sc">+</span> groupF, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = count ~ antibodyF + groupF, family = "poisson")

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.78111    0.21184  13.129   &lt;2e-16 ***
antibodyF2  -0.17589    0.26593  -0.661   0.5083    
antibodyF3  -0.66140    0.30783  -2.149   0.0317 *  
groupF2     -0.08224    0.23428  -0.351   0.7256    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 23.807  on 5  degrees of freedom
Residual deviance: 18.643  on 2  degrees of freedom
AIC: 51.771

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Hence, our proposed model has a residual deviance of <span class="math inline">\(18.643\)</span> on <span class="math inline">\(2\)</span> degrees of freedom. The chi-square test gives a <span class="math inline">\(p\)</span>-value of <span class="math display">\[p = \mbox{Pr}(\chi^2_2 &gt; 18.643) = 8.95\times 10^{-5},\]</span> so we reject the independence model in favour of the saturated model.</p>
<p>For the independence model <span class="math display">\[
\hat\pi_{ij} =
{ e^{\hat\beta_j}}\Big/ {\sum_j e^{\hat\beta_j}}
\]</span> whose right-hand side does not depend on <span class="math inline">\(i\)</span> and hence is the same for all rows. The corresponding fitted values are then given by <span class="math inline">\(\hat y_{ij} = y_{i+} \hat \pi_{ij}\)</span>.</p>
</section>
<section id="exercises" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.5</span> Exercises</h2>
<div class="webex-box">
<p>7.1 Consider a <span class="math inline">\(2 \times m\)</span> contingency table with entries <span class="math inline">\(y_{ij}, \ i=1,2,\ j=1,\ldots,m\)</span>. The rows label STATUS represents <em>alive</em> (STATUS = 1) or <em>dead</em> (STATUS=2) and the columns label AGE represents <span class="math inline">\(m\)</span> age groups <span class="math inline">\((\mbox{AGE} = 1,\ldots,m\)</span>) and not the exact age.</p>
<p>Suppose that a Poisson model <span class="math inline">\(P(\lambda_{ij})\)</span> with <span class="math display">\[
\log(\lambda_{ij}) = \delta + \alpha_i+ \beta_j + \gamma_i \, AGE_j
\]</span> is considered appropriate. Note that <span class="math inline">\(AGE_j=j\)</span> is treated as a quantitative variable in the last term. What additional constraints on the parameters should be included to make estimation unique – that is to remove the aliasing problem.</p>
<p>Suppose that the column totals, <span class="math inline">\(Y_{+j}\)</span>, are fixed. Explain why a product binomial model <span class="math inline">\(B(y_{+j},\pi_j), \ j=1,\ldots,m\)</span>, is suitable in this case and find the form of <span class="math inline">\(\pi_j.\)</span> Which parameters can be estimated under this model?</p>
<p>7.2 In the product-multinomial model for a table with fixed row totals, model parameter estimates are given as the solution of <a href="#eq-fixedrows">Equation&nbsp;<span>7.2</span></a> and it was claimed that this had the same form as for the previous independence Poisson model (without fixed row totals). Use <a href="6_loglinearmodel.html#eq-muest">Equation&nbsp;<span>6.4</span></a> and <a href="6_loglinearmodel.html#eq-betaest">Equation&nbsp;<span>6.6</span></a> to show that indeed the estimation equations are identical and hence that the parameter estimates will be the same.</p>
</div>
<p><br>
</p>
<!-- ::: {.callout-note appearance="default"} -->
<!-- [Exercise 7 Solutions can be found here.](https://richardpmann.com/MATH3823/Solutions_7.html) -->
<!-- ::: -->


</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./6_loglinearmodel.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loglinear Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>